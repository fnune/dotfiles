#!/usr/bin/env bash

set -euo pipefail

# Memfault
memfault_path="$HOME/Development/memfault"
tmux new-session -c $memfault_path -d -s memfault -n auxiliary

tmux split-window -c $memfault_path -h
tmux send-keys "invoke dc.svc --log-sql" C-m
tmux split-window -c $memfault_path -v
tmux send-keys "rm .overmind.sock; INVOKE_MEMFAULT_PROCFILE_RUNNER=overmind invoke -e dev" C-m
tmux split-window -c $memfault_path -v
tmux send-keys "invoke ingress.dev" C-m
tmux select-layout main-vertical

tmux new-window -c $memfault_path -n editor
tmux send-keys -t memfault:editor $EDITOR C-m

# Memfault docs
memfault_docs_path="$HOME/Development/memfault-docs"
tmux new-session -c $memfault_docs_path -d -s memfault-docs -n auxiliary

tmux split-window -c $memfault_docs_path -h
tmux send-keys "yarn start --no-open"
tmux select-layout main-vertical

tmux new-window -c $memfault_docs_path -n editor
tmux send-keys -t memfault-docs:editor $EDITOR C-m

# Memfault fixtures
memfault_fixtures_path="$memfault_path/tools/tests/fixtures/binaries"
tmux new-session -c $memfault_fixtures_path -d -s memfault-fixtures -n editor
tmux send-keys -t memfault-fixtures:editor $EDITOR C-m

# Journal
journal_path="$HOME/.journal"
tmux new-session -c $journal_path -d -s journal -n editor
tmux send-keys -t journal:editor add-inbox C-m

# Take-off
tmux attach-session -t memfault
